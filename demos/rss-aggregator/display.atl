// Display module - CLI output formatting
import { substring } from "std:string";

// Display header
export fn displayHeader() -> void {
    print("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    print("â•‘          RSS Feed Aggregator                      â•‘");
    print("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    print("");
}

// Display feed fetching progress
export fn displayFeedProgress(feedName: string, index: number, total: number) -> void {
    print("ðŸ“¡ [" + toString(index) + "/" + toString(total) + "] Fetching: " + feedName);
}

// Display feed result
export fn displayFeedResult(feedTitle: string, itemCount: number) -> void {
    print("  âœ… " + feedTitle + " (" + toString(itemCount) + " articles)");
}

// Display feed error
export fn displayFeedError(feedName: string, error: string) -> void {
    print("  âŒ " + feedName + ": " + error);
}

// Truncate text to max length
fn truncate(text: string, maxLength: number) -> string {
    if len(text) <= maxLength {
        return text;
    } else {
        return substring(text, 0, maxLength) + "...";
    }
}

// Display single article
export fn displayArticle(article: JsonValue, index: number) -> void {
    let title: string = jsonAsString(article["title"]);
    let link: string = jsonAsString(article["link"]);
    let source: string = jsonAsString(article["feedTitle"]);
    let pubDate: string = jsonAsString(article["pubDate"]);
    let description: string = jsonAsString(article["description"]);

    print("");
    print("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
    print(toString(index) + ". " + title);
    print("   Source: " + source);
    if len(pubDate) > 0 {
        print("   Date: " + pubDate);
    }
    print("   Link: " + truncate(link, 60));

    if len(description) > 0 {
        let cleanDesc: string = replace(description, "<[^>]+>", "");
        print("   " + truncate(cleanDesc, 100));
    }
}

// Display summary
export fn displaySummary(totalArticles: number, uniqueArticles: number, feedCount: number) -> void {
    print("");
    print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    print("  Summary");
    print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    print("  Feeds Fetched:     " + toString(feedCount));
    print("  Total Articles:    " + toString(totalArticles));
    print("  Unique Articles:   " + toString(uniqueArticles));
    print("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    print("");
}

// Display tips
export fn displayTips() -> void {
    print("ðŸ’¡ Tips:");
    print("  â€¢ Edit feeds/feeds.json to add/remove RSS sources");
    print("  â€¢ Feed data cached for 15 minutes");
    print("  â€¢ Results exported to output/aggregated-feed.json");
    print("");
}
